<!doctype html>
<html>
  <head>
    <style>
        *{margin: 0;padding: 0;}
        body{
        	background: black;
            overflow: hidden;
        }
        canvas {
		    padding: 0;
		    margin: 0;

		    width: 100vw; 
		    max-width: 100%;
		    height: auto;
		    max-height: 100%;

		    user-select: none; 
		}
    </style>
  </head>
  <body>
    <!-- <script src="https://pixijs.download/release/pixi.js"></script> -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/8.2.6/pixi.min.js"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.4.2/pixi.min.js"></script>
    <script src="assets/js/viewport.min.js"></script>
    <script type="module">
        const isViewPort = true;
        const version = 7;
        //import { Assets } from 'pixi.js';

        const WORLD_WIDTH = 2400;
        const WORLD_HEIGHT = 1840;

        
        if(version == 7){
            var app = new PIXI.Application({ height: window.innerHeight, width: window.innerWidth, resizeTo: window });
            globalThis.__PIXI_APP__ = app;
            document.body.appendChild(app.view);
        }else{
            var app = new PIXI.Application();
            if(!isViewPort){
                await app.init({ height: window.innerHeight, width: window.innerWidth, resizeTo: window });
            }else{
                await app.init({ height: window.innerHeight, width: window.innerWidth, resizeTo: window });
            }
            globalThis.__PIXI_APP__ = app;
            document.body.appendChild(app.canvas);
        }

        //show loading screen
        var loading_container = new PIXI.Container();
        loading_container.label = "Loading";
        await PIXI.Assets.load({alias: '04B_30__', src:'assets/fonts/04B_30__.woff'}, ()=>{
            var loading_text = new PIXI.Text('Loading',{
                fontSize: 24,
                fontFamily:'04B_30__',
                fill: 0xff1010,
                align: 'center',
            });
            loading_text.position.set(window.innerWidth / 2,  window.innerHeight / 2);
            loading_container.addChild(loading_text);
            app.stage.addChild(loading_container);
        });
        
        if(isViewPort){
            
            var viewport = new PIXI.Viewport({
                screenWidth: window.innerWidth,
                screenHeight: window.innerHeight,
                worldWidth: WORLD_WIDTH,
                worldHeight: WORLD_HEIGHT,
                events: app.renderer.events,
                stopPropagation: true
                //interaction: app.renderer.__plugins.interaction // the interaction module is important for wheel to work properly when renderer.view is placed or scaled
            });
            
        }

        //loading
        let Hills_array = [];
        for (let i = 0; i < 67; i++) {
            Hills_array.push({alias: 'hills_'+i, src: 'assets/backgrounds/Hills/Hills_'+i+'.png'});
        }

        PIXI.Assets.addBundle('resources', [
            {alias: 'Water_Anim_json', src: 'assets/backgrounds/Anim/Water_Anim.json'},
            {alias: 'Water_Anim_img', src: 'assets/backgrounds/Anim/Water_Anim.png'},
            {alias: 'Rock7_water_shadow1', src: 'assets/backgrounds/stones/Rock7_water_shadow1.png'},
            {alias: 'Rock7_water_shadow2', src: 'assets/backgrounds/stones/Rock7_water_shadow2.png'},
            {alias: 'Rock7_water_shadow3', src: 'assets/backgrounds/stones/Rock7_water_shadow3.png'},
            {alias: 'Rock7_water_shadow4', src: 'assets/backgrounds/stones/Rock7_water_shadow4.png'},
            {alias: 'Rock7_water_shadow5', src: 'assets/backgrounds/stones/Rock7_water_shadow5.png'},
            {alias: 'Tree_1', src: 'assets/backgrounds/Trees/32.png'},
            {alias: 'Tree_2', src: 'assets/backgrounds/Trees/34.png'},
            {alias: 'heart', src: 'assets/backgrounds/heart/heart.png'},
        ].concat(Hills_array));

        const resources = await PIXI.Assets.loadBundle('resources', ()=>{
            console.log("assets loaded");
        });
        
        var home_container = new PIXI.Container();
        home_container.label = "Home Container";

        home_container.addChild( await add_Water_bg());
        home_container.addChild( await add_ground());
        

        if(isViewPort){
            viewport.addChild(home_container);
            app.stage.addChild(viewport)
            viewport.drag()
            //viewport.pinch()
            viewport.wheel()
            viewport.decelerate(); 
            //viewport.moveCenter(WORLD_WIDTH / 2, WORLD_HEIGHT / 2)
            viewport.clamp({direction: "all", left:0, right: WORLD_WIDTH, top:0, bottom: WORLD_HEIGHT});
            viewport.clampZoom({minScale:1,maxScale:1});

            //initial view set
            viewport.moveCorner(0,1000);
        }else{
            app.stage.addChild(home_container);
            //app.stage.scale.set(0.4,0.4)
        }

        app.stage.addChild( await add_frame());

        // adds the ocean background
        async function add_Water_bg(){
            var bg_water = new PIXI.Container();
            bg_water.label = "Water";
 
            for (let i = 0; i < 30; i++) {
                for (let j = 0; j < 23; j++) {
                    if( i>6 && i<20 && j>6 && j<18) continue;
                    let anim = new PIXI.AnimatedSprite(resources.Water_Anim_json.animations.Water);
                    anim.position.set(i*80,j*80);
                    anim.animationSpeed = 1/10;   
                    anim.loop = true;
                    anim.play();
                    bg_water.addChild(anim);
                }            
            }

            return bg_water;
        }

        async function add_ground(){
            var bg_land = new PIXI.Container();
            bg_land.label = "Land";

            let land_pattern_arr = [
                ["--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--"],
                ["--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--"],
                ["--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--"],
                ["--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--"],
                ["--","--","--","--","--","--","--","--","--","--","00","01","01","01","01","01","01","01","01","01","01","01","01","01","01","01","01","01","01","01","01","01","01","01","01","01","01","01","01","01","01","01","01","01","01","01","02","--","--","--","--","--","--","--"],
                ["--","--","--","--","--","--","00","01","01","01","26","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","25","02","--","--","--","--","--","--"],
                ["--","--","--","--","--","00","26","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","25","02","--","--","--","--","--"],
                ["--","--","--","--","00","26","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","25","02","--","--","--","--"],
                ["--","--","--","--","10","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","12","--","--","--","--"],
                ["--","--","--","--","10","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","12","--","--","--","--"],
                ["--","--","--","--","10","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","12","--","--","--","--"],
                ["--","--","--","--","10","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","12","--","--","--","--"],
                ["--","--","--","--","10","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","12","--","--","--","--"],
                ["--","--","--","--","10","11","11","11","11","53","52","53","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","12","--","--","--","--"],
                ["--","--","--","--","10","11","11","11","53","52","53","52","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","12","--","--","--","--"],
                ["--","--","--","--","10","11","11","11","52","53","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","12","--","--","--","--"],
                ["--","--","--","--","10","11","11","11","53","52","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","12","--","--","--","--"],
                ["--","--","--","--","10","11","11","11","52","53","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","12","--","--","--","--"],
                ["--","--","--","--","10","11","11","11","53","52","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","12","--","--","--","--"],
                ["--","--","--","--","10","11","11","11","53","53","52","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","12","--","--","--","--"],
                ["--","--","--","--","10","11","11","11","11","53","53","52","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","12","--","--","--","--"],
                ["--","--","--","--","10","11","11","11","11","11","52","53","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","12","--","--","--","--"],
                ["--","--","--","--","10","11","11","11","11","11","53","52","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","12","--","--","--","--"],
                ["--","--","--","--","10","11","11","11","11","53","52","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","12","--","--","--","--"],
                ["--","--","--","--","10","11","11","11","11","52","53","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","12","--","--","--","--"],
                ["--","--","--","--","10","11","11","11","11","53","52","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","12","--","--","--","--"],
                ["--","--","--","--","10","11","11","11","11","52","53","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","12","--","--","--","--"],
                ["--","--","--","--","10","11","11","11","11","53","52","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","12","--","--","--","--"],
                ["--","--","--","--","10","11","11","11","11","52","53","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","12","--","--","--","--"],
                ["--","--","--","--","10","11","11","11","11","53","52","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","12","--","--","--","--"],
                ["--","--","--","--","10","11","11","11","11","52","53","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","12","--","--","--","--"],
                ["--","--","--","--","10","11","11","11","11","53","52","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","12","--","--","--","--"],
                ["--","--","--","--","10","11","11","11","11","52","53","52","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","12","--","--","--","--"],
                ["--","--","--","--","10","11","11","11","11","11","52","53","52","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","15","22","--","--","--","--"],
                ["--","--","--","--","20","16","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","15","22","--","--","--","--","--"],
                ["--","--","--","--","--","20","21","16","11","11","11","11","21","21","21","55","56","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","15","21","22","--","--","--","--","--","--"],
                ["--","--","--","--","--","--","--","20","16","11","11","11","11","11","11","65","66","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","15","21","21","21","21","21","21","21","21","21","22","--","--","--","--","--","--","--","--"],
                ["--","--","--","--","--","--","--","--","20","21","21","21","21","21","21","21","21","21","21","21","21","21","21","21","21","21","21","21","21","21","21","21","21","21","21","22","--","31","32","32","32","33","--","--","--","--","--","--","--","--","--","--","--","--"],
                ["--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","31","32","33","--","--","--","--","--","--","--","--","--","--","--","--","--"],
                ["--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--"],
                ["--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--"],
                ["--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--","--"],
            ];

            let start = {x:100,y:100};
            for (let i = 0; i < land_pattern_arr.length; i++) {
               for (let j = 0; j < land_pattern_arr[i].length; j++) {
                    if(land_pattern_arr[i][j]=="--") continue;
                    bg_land.addChild(addSprite(resources["hills_"+parseInt(land_pattern_arr[i][j])], start.x+j*40,start.y+i*40,0.5,0.5));             
               }
                
            }

            bg_land.addChild(addSprite(resources["Rock7_water_shadow1"], 250,100,1,1));
            bg_land.addChild(addSprite(resources["Rock7_water_shadow3"], 220,200,1,1));
            bg_land.addChild(addSprite(resources["Rock7_water_shadow4"], 275,186,1,1));
            bg_land.addChild(addSprite(resources["Rock7_water_shadow4"], 240,160,1,1));
            bg_land.addChild(addSprite(resources["Tree_1"], 350,300,0.4,0.4));
            bg_land.addChild(addSprite(resources["Tree_1"], 450,300,0.4,0.4));
            bg_land.addChild(addSprite(resources["Tree_1"], 550,300,0.4,0.4));
            bg_land.addChild(addSprite(resources["Tree_1"], 400,400,0.4,0.4));
            bg_land.addChild(addSprite(resources["Tree_1"], 500,400,0.4,0.4));
            bg_land.addChild(addSprite(resources["Tree_2"], 350,400,0.4,0.4));
            bg_land.addChild(addSprite(resources["Tree_2"], 300,450,0.4,0.4));
            bg_land.addChild(addSprite(resources["Tree_2"], 370,450,0.4,0.4));
            bg_land.addChild(addSprite(resources["Tree_2"], 350,500,0.4,0.4));



            return bg_land;
        }

        async function add_frame(){
            var frame_container = new PIXI.Container();
            frame_container.label = "Frame";

            frame_container.addChild(addSprite(resources['heart'], 10,10,2,2));
            frame_container.addChild(addSprite(resources['heart'], 60,10,2,2));
            frame_container.addChild(addSprite(resources['heart'], 110,10,2,2));

            return frame_container;
        }
        function addSprite(resource, x,y,sx,sy){
            let sp = new PIXI.Sprite(resource);
            sp.position.set(x,y);
            sp.scale.set(sx,sy);
            return sp;
        }

        
      </script>
  </body>
</html>