<!doctype html>
<html>
  <head>
    <style>
        *{margin: 0;padding: 0;}
        body{
        	background: black;
        }
        canvas {
		    padding: 0;
		    margin: 0;

		    width: 100vw; 
		    max-width: 100%; /* ensures that it doesn't overflow */
		    height: auto;
		    max-height: 100%; /* ensures that it doesn't overflow */

		    user-select: none; /* removes accidental selection */
		}
    </style>
  </head>
  <body>
    <script src="https://pixijs.download/release/pixi.js"></script>
    <!-- <script src="assets/js/viewport.min.js"></script> -->
    <script type="module">
        //import { Assets } from 'pixi.js';

        const app = new PIXI.Application();
        await app.init({ height: window.innerHeight, width: window.innerWidth, resizeTo: window });
        globalThis.__PIXI_APP__ = app;
        document.body.appendChild(app.canvas);

        //loading
        let Hills_array = [];
        for (let i = 0; i < 67; i++) {
            Hills_array.push({alias: 'hills_'+i, src: 'assets/backgrounds/Hills/Hills_'+i+'.png'});
        }

        PIXI.Assets.addBundle('resources', [
            {alias: 'Water_Anim_json', src: 'assets/backgrounds/Anim/Water_Anim.json'},
            {alias: 'Water_Anim_img', src: 'assets/backgrounds/Anim/Water_Anim.png'},
        ].concat(Hills_array));

        const resources = await PIXI.Assets.loadBundle('resources', ()=>{
            console.log("assets loaded");
        });

        //const animated_sprites = {};
        /* const sprite = PIXI.Sprite.from(resources.Water_Anim_img);
        sprite.width = 512;
        sprite.height = 512;
        // Adds a sprite as a child to this container. As a result, the sprite will be rendered whenever the container
        // is rendered. */
        
        //home_container.addChild(sprite);
        var home_container = new PIXI.Container();
        home_container.label = "Home Container";

        home_container.addChild( await add_Water_bg());
        home_container.addChild( await add_ground());


        app.stage.addChild(home_container);
        app.stage.scale.set(0.2,0.2)

        // adds the ocean background
        async function add_Water_bg(){
            var bg_water = new PIXI.Container();
            bg_water.label = "Water";

            const water_sheet = new PIXI.Spritesheet(resources.Water_Anim_img, resources.Water_Anim_json.data);
            await water_sheet.parse();
            let water_texture_arr = [];
            for (let i = 0; i < 4; i++) {
                let texture = new PIXI.Texture(water_sheet.textures["Water_"+i+".png"]);
                water_texture_arr.push(texture);
            }
            const water_animation =  new PIXI.AnimatedSprite(water_texture_arr);
            water_animation.animationSpeed = 1/10;                  // 10 fps
            water_animation.position.set(0, 0); // almost bottom-left corner of the canvas
            water_animation.loop = true;
            water_animation.play();

            for (let i = 0; i < 30; i++) {
                for (let j = 0; j < 23; j++) {
                    if( i>6 && i<20 && j>6 && j<18) continue;
                    let anim = new PIXI.AnimatedSprite(water_texture_arr);
                    anim.position.set(i*80,j*80);
                    anim.animationSpeed = 1/10;   
                    anim.loop = true;
                    anim.play();
                    bg_water.addChild(anim);
                }            
            }

            return bg_water;
        }

        async function add_ground(){
            var bg_land = new PIXI.Container();
            bg_land.label = "Land";

            let land_pattern_arr = [
                ["_","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11"],
                ["11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11"],
                ["11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11"],
                ["11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11"],
                ["11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11"],
                ["11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11"],
                ["11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11"],
                ["11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11"],
                ["11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11"],
                ["11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11"],
                ["11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11"],
                ["11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11"],
                ["11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11"],
                ["11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11"],
                ["11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11"],
                ["11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11"],
                ["11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11"],
                ["11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11"],
                ["11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11"],
                ["11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11"],
                ["11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11"],
                ["11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11"],
                ["11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11"],
                ["11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11"],
                ["11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11"],
                ["11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11"],
                ["11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11"],
                ["11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11"],
                ["11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11"],
                ["11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11"],
                ["11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11","11"],
            ];

            let start = {x:300,y:300};
            for (let i = 0; i < land_pattern_arr.length; i++) {
               for (let j = 0; j < land_pattern_arr[i].length; j++) {
                    if(land_pattern_arr[i][j]=="_") continue;
                    bg_land.addChild(addSprite(resources["hills_"+land_pattern_arr[i][j]], start.x+j*40,start.y+i*40,0.5,0.5));             
               }
                
            }
            return bg_land;
        }

        function addSprite(resource, x,y,sx,sy){
            let sp = new PIXI.Sprite(resource);
            sp.position.set(x,y);
            sp.scale.set(sx,sy);
            return sp;
        }
      </script>
  </body>
</html>